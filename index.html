<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Customer/CSS/index.css">
    <script src="Customer/JS/function.js"></script>
    <link rel="icon" type="image/x-icon" href="Customer/Media/Icon.jpg">
    <title>Sign In</title>
</head>

<body>
    <!-- wrapper -->
    <section class="home">
        <div class="home_top">
            <img class="logo" src="Customer/Media/Logo.png">
        </div>
        <div class="home_center">
            <form action="" class="home_form" id="form">
                <div class="form__links">
                    <a href="#" class="form-link link-active">Signin</a>
                    <a href="./index2.html" class="form-link">Signup</a>
                </div>
                <div>
                    <input id="username" class="form-control" type="text" placeholder="Enter Email or Username"
                        name="username" required>
                </div>
                <div>
                    <input id="password" class="form-control" type="password" placeholder="Enter Password"
                        name="password" required>
                </div>
                <span class="txt-center center error"></span>
                <div class="button">
                    <button class="btn submit center" type="submit">Signin</button>
                    <a class="secondary center txt-center forgot" href="#">Forgot Password?</a>
                </div>
                <span class="txt-center center secondary">Copyrights ABC Hotel 2022</span>
                <!-- error display -->
                
            </form>
        </div>
    </section>

    <script>
        //target form
        const form = document.querySelector("#form");
        const username = document.querySelector("#username");
        const password = document.querySelector("#password");
        const errorDisplay = document.querySelector(".error");

        // prevent form from submitting
        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            try {


                //redirect to admin
                if (username.value === "admin" && password.value === "admin") {
                    location.replace("admin/admin.html");
                    return;
                }

                let data = await fetch('users.json');


                if (!data.ok) {
                    throw new Error('Internal Error');
                }

                const users = await data.json();

                users.forEach(user => {
                    if (user.username === username.value && user.password === password.value) {
                        location.replace("Customer/Webpages/Dashboard.html");
                        sessionStorage.setItem("username", user.username);
                        sessionStorage.setItem("password", user.password);
                        sessionStorage.setItem("room", user.room);
                        sessionStorage.setItem("id", user.id);
                        throw new Error('');
                    }
                });

                throw new Error('Incorrect Username or Password');
            } catch (error) {
                errorDisplay.innerHTML = error.message;
            }
        })
    </script>
</body>

</html>